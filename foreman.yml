---
- name: Get nodes from nova
  hosts: local
  gather_facts: False
  roles:
    - get_nodes

- include: playbooks/set_facts.yml
- include: playbooks/wait_for_nodes.yml

- name: Perform Foreman install
  hosts: foreman_installer
  user: root
  roles:
    - { role: common }
    - { role: foreman/foreman-common }
    - { role: foreman/foreman-network-setup }
    - { role: foreman/foreman-openstack-installer, when: "'foreman' in group_names" }
    - { role: foreman/foreman-openstack-node,
        foreman_node_hostgroup: OpenStack Neutron Controller,
        when: "'controller' in group_names" }
    - { role: foreman/foreman-openstack-node,
        foreman_node_hostgroup: OpenStack Neutron Compute,
        when: "'compute' in group_names" }
    - { role: foreman/foreman-openstack-node,
        foreman_node_hostgroup: OpenStack Neutron Networker,
        when: "'networker' in group_names" }
    - { role: foreman/foreman-openstack-createrc }

- name: Run tempest
  hosts: controller
  user: root
  roles:
    - { role: tempest }
