---
- name: Remove yum-rhn-plugin
  yum: name=yum-rhn-plugin state=absent

- name: Yum clean all
  command: yum clean all

- name: Ensure libselinux-python
  yum: name=libselinux-python

- name: Remove all yum repositories
  file: path=/etc/yum.repos.d/*.repo state=absent
  when: ansible_distribution == "RedHat"

- name: Create the RHEL Repositories
  template: src=rhel.repo.j2 dest=/etc/yum.repos.d/rhel.repo
  when: ansible_distribution == "RedHat"

- name: Create the EPEL Repository
  template: src=epel.repo.j2 dest=/etc/yum.repos.d/epel.repo
  when: ansible_distribution == "RedHat"

- name: Yum clean all
  command: yum clean all

- name: Ensure httplib2
  yum: name=python-httplib2 state=present

- name: Ensure libselinux-python
  yum: name=libselinux-python

- name: be sure ntp is installed
  yum: pkg=ntp state=installed
  tags: ntp

- name: be sure ntp is configured
  template: src=ntp.conf.j2 dest=/etc/ntp.conf
  notify:
    - restart ntpd
  tags: ntp

- name: be sure ntpd is running and enabled
  service: name=ntpd state=running enabled=yes
  tags: ntp

- name: yum -y update to latest packages
  yum: name=* state=latest
  notify:
      - reboot
      - Wait for host to stop
      - Wait for host to come back
      - Reload facts

- meta: flush_handlers
