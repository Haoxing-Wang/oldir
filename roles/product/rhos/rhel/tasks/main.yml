---
#python-backports is installed as a dep for cloud-init
- name: Remove python-backports if installed
  yum: name=python-backports state=removed

- name: Install rhos-release
  yum: name={{ product.rpm[ansible_distribution] }} state=present

- name: Setting repo through launching rhos-release
  command: "rhos-release {{ product.version|int }}"

- name: Inject poodle URL into repo if defined
  ini_file: dest=/etc/yum.repos.d/rhos-release-{{ poduct.version|int }}-rhel-{{ ansible_distribution_version|int }}
            section=rhelosp-{{ product.version }}-el{{ ansible_distribution_version|int}}
            option=baseurl
            value={{ product.repo.puddle }}
  when: product.repo.puddle.[ansible_distribution][ansible_distribution_version] is defined

#- name: Create the RHOS poodle repositories for RHEL
#  template: src=rhos_poodle.repo.j2 dest=/etc/yum.repos.d/rhos_poodle.repo
#  notify:
#    - Yum clean all

- name: List available yum repositories
  command: yum -d 9 repolist
  register: result

- name: Print repolist
  debug: var=result.stdout_lines
