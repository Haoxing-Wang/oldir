---
- name: Create the RHOS Release Repository
  template: src=rhos-release.repo.j2 dest=/etc/yum.repos.d/rhos-release.repo

- name: install rhos-release
  yum: name=rhos-release state=latest

- name: Execute rhos-release {{ product.version|int }}
  command: rhos-release {{ product.version|int }}

- name: Inject poodle URL into repo if defined
  ini_file: dest=/etc/yum.repos.d/rhos-release-{{ product.version|int }}-rhel-{{ ansible_distribution_version|int }}.repo
            section=rhelosp-{{ product.version }}-el{{ ansible_distribution_version|int}}
            option=baseurl
            value={{ product.repo.puddle[ansible_distribution][ansible_distribution_version] }}
  when: "product.repo.puddle[ansible_distribution][ansible_distribution_version] is defined"

