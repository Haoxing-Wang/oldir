---
- name: dump network and node info
  debug: var=hostvars
  when: "'debug' in config.verbosity"

- name: ensure tempest node can connect to controller
  command: >
    iptables -I INPUT 1
    -s {{ hostvars[tempest_name]['ansible_' + item].ipv4.address }}/32
    -p tcp -j ACCEPT
  when: item not in ('lo')
    and hostvars[tempest_name]['ansible_' + item].ipv4.address is defined
  with_items: ansible_interfaces

- name: save iptables
  shell: service iptables save
  sudo: yes

# - name: restart iptables
#   service: name=iptables state=restarted
