- name: rpm | repo used
  debug: msg="using tempest repo {{ tempest_rpm_repo }}" #"
  tags: tempest_setup_rpm

- name: rpm | create the tempest Repository
  template: src=tempest.repo.j2 dest=/etc/yum.repos.d/tempest.repo
  tags:
    - tempest_setup_rpm
  notify:
    - Yum clean all
    - Yum repolist

- meta: flush_handlers

- name: rpm | install tempest rpm
  command: yum install -y openstack-tempest
  tags: tempest_setup_rpm

- name: rpm | get tempest install directory
  shell: rpm -ql openstack-tempest | grep 'openstack-tempest$'
  register: tempest_install_dir
  tags: tempest_setup_rpm

- debug: msg="{{ tempest_install_dir.stdout }}"
  tags: tempest_setup_rpm

- debug: msg="{{ tempest.checkout_dir }}"
  tags: tempest_setup_rpm


- name: rpm | fail if the install dir is different from
        tempest.checkout_dir
  fail: msg="failing because install dir {{ tempest_install_dir.stdout }}
             is not equal to {{tempest.checkout_dir}}" #"
  when: tempest_install_dir.stdout != tempest.checkout_dir
  tags: tempest_setup_rpm

- include: generate-tempest-conf.yml
