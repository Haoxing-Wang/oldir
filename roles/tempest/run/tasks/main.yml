---
- name: remove {{ tempest.dir }}/.testrepository
  file: path={{ tempest.dir }}/.testrepository state=absent
  tags: tempest_run

- name: Run tempest
  shell: "source {{ tempest.dir }}/.venv/bin/activate; cd {{ tempest.dir }}; testr init; tools/run-tests.sh {{ tempest.test_name }}"
  tags: tempest_run
  ignore_errors: True

- name: Fetch results
  fetch: src={{ tempest.dir }}/tempest.xml
         dest=nosetests.xml flat=yes
  tags: tempest_run
