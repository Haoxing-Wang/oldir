---
- name: remove any previously installed rdo-release
  command: rm -f /etc/yum.repos.d/rdo-release.repo
  ignore_errors: true
  notify:
    - Yum clean all

- name: Install rdo-release
  yum: name="{{ tempest.rdo.rpm }}" state=present

- name: Turn off foreman repos
  ini_file: dest=/etc/yum.repos.d/foreman.repo
            section={{ item }}
            option=enabled
            value=0
  with_items:
    - foreman
    - foreman-plugins
  notify:
    - Yum clean all

- name: List available yum repositories
  command: yum -d 7 repolist
  register: result

- name: Print repolist
  debug: var=result.stdout_lines

- name: Install rpm dependencies
  yum: name={{ item }} state=present
  register: result
  with_items:
    - facter
    - gcc
    - git
    - libffi-devel
    - libxml2-devel
    - libxslt-devel
    - mariadb-devel
    - openssl-devel
    - packstack-modules-puppet
    - puppet
    - python-glanceclient
    - python-keystoneclient
    - python-neutronclient
    - python-novaclient
    - python-ceilometerclient
    - python-pip
    - python-virtualenv
    - python-testrepository
  tags:
    - tempest_setup

- name: Pretty print yum install dependencies
  debug: var=result.stdout_lines

- name: Install additional rpm dependencies
  yum: name={{ item }} state=present
  register: result
  with_items:
    - python-saharaclient
  when: product.version not in ['grizzly', 'havana']
  tags:
    - tempest_setup

- name: Print out yum install additional rpm dependencies
  debug: var=result.stdout_lines
