---
- name: reboot
  command: "/sbin/shutdown -r  {{ distro.config.reboot_delay }} {{distro_reboot_options}}"

- name: Wait for host to stop
  sudo: no
  local_action:
        wait_for host={{ hostvars[inventory_hostname].ansible_ssh_host }}
                 port=22
                 state=stopped
                 timeout=120

- name: Wait for host to come back
  sudo: no
  local_action:
        wait_for host={{ hostvars[inventory_hostname].ansible_ssh_host }}
                 port=22
                 state=started
                 timeout=600

- name: Reload facts
  action: setup

- name: Yum clean all
  command: yum clean all

- name: Yum repolist
  command: yum repolist
  ignore_errors: yes


- name: yum -y update to latest packages
  yum: name=* state=latest
  notify:
    - reboot
    - Wait for host to stop
    - Wait for host to come back
    - Reload facts
  when: yum_update | bool

- name: restart network
  service: name=network state=restarted
  notify:
    - Reload facts
