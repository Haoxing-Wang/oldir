---
- name: Print host openstack network type (nova/neutron)
  debug: var=os_network_type

- debug: var=nodes_created
  when: "'debug' in config.verbosity"

- debug: var=floating_ips
  when: "'debug' in config.verbosity"

- name: Network {{ os_network_type }} == {{ network_expected }} | Add hosts
  add_host:
      name="{{ item.0.item.name }}"
      groups="{{ item.0.item.groups
        if item.0.item.groups is string
        else item.0.item.groups| join(',') }}"
      ansible_ssh_private_key_file="{{ ssh_private_key }}"
      ansible_ssh_user="{{ item.0.item.remote_user }}"
      ansible_fqdn="{{ item.0.item.hostname }}"
      ansible_ssh_host="{% if item.0.instances is defined %}{{ item.0.instances.0.accessIPv4 }}{% else %}{{ item.1.public_ip}}{% endif %}"
      nodes_created_dict="{{ item.0 }}"
      floating_ip_dict="{{ item.1 }}"
  with_together:
    - nodes_created
    - floating_ips
