---
- name: Add RDO/RHOS repos
  yum: name={{ openstack_foreman_installer_repo_rpm }}

- name: Install openstack-foreman-installer rpm
  yum: name=openstack-foreman-installer state=present

- name: Deactivate iptables
  service: name=iptables enabled=no state=stopped

- name: Specify foreman environment
  template: src=foreman_env dest=/tmp/foreman_env mode=0644

- name: Ensure optional repo
  command: /usr/bin/yum-config-manager --enable rhel-6-server-optional-rpms

- name: Make passwords the same for foreman environment
  command: /bin/sed -i -e 's/SecureRandom.hex/"redhat"/' /usr/share/openstack-foreman-installer/bin/seeds.rb

- name: Remove the prompt in foreman_server.sh
  command: "/bin/sed -i -e 's/^\\(read.*\\)//' /usr/share/openstack-foreman-installer/bin/foreman_server.sh"

- name: Run the installer
  shell: "source /tmp/foreman_env && cd /usr/share/openstack-foreman-installer/bin && bash -x ./foreman_server.sh"
