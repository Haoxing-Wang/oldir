---
# group hosts by distro
- name: Bootstrap testbed VMs
  hosts: all:!localhost
  tasks:
    - group_by: key={{ ansible_distribution }}

- name: Workarounds | specific to fedora distro
  hosts: Fedora:&tempest
  tasks:
     - { include: "fedora/fix_tempest_mariadb.yml",
          name: 'WORKAROUND | BZ 981116 | edit tempest puppet to use mariadb',
          tags: workaround,
          when: workaround_tempest_mariadb is defined and workaround_tempest_mariadb
       }

- name: Workarounds | specific to fedora distro
  hosts: Fedora:&controller
  tasks:
     - { include: "common/fix-puppet-utf8.yml",
          name: 'WORKAROUND | no bz',
          tags: workaround,
          when: workaround_puppet_utf8 is defined and workaround_puppet_utf8
       }

- name: Workarounds | specific to RedHat distro
  hosts: RedHat:&controller
  tasks:
    - { include: "common/fix-puppet-utf8.yml",
          name: 'WORKAROUND | no bz',
          tags: workaround,
          when: workaround_puppet_utf8 is defined and workaround_puppet_utf8
       }
    - { include: "rhel/update_to_epel_beta.yml",
         name: 'WORKAROUND | BZ  | change epel to epel beta',
         tags: workaround,
         when: workaround_epel_beta is defined and workaround_epel_beta and ansible_distribution_version == "7.0"
       } 
    - { include: "fedora/fix_tempest_mariadb.yml",
          name: 'WORKAROUND | BZ 981116 | edit tempest puppet to use mariadb',
          tags: workaround,
          when: workaround_tempest_mariadb is defined and workaround_tempest_mariadb and ansible_distribution_version == "7.0"
       }
