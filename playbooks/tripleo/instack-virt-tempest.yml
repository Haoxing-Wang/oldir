---
#- include: ../vm_import_image.yml

- name: set up environment
  hosts: instack-virt-host
  sudo: yes
  roles:
    - { role: tripleo/instack/setup-env/virt-setup-tempest/define-env }

- name: get ssh key  from undercloud
  hosts: undercloud
  roles:
    - { role: tripleo/instack/setup-env/virt-setup-tempest/undercloud-sshkey }

- name: verify ssh connection from instack-virt-host
  hosts: all:!localhost
  roles:
    - { role: tripleo/instack/setup-env/virt-setup-tempest/verify-ssh }

- name: get config from controller
  hosts: controller
  sudo: yes
  roles:
    - { role: tripleo/instack/setup-env/virt-setup-tempest/overcloud-keystonerc }

- include: ../group_by.yml

- include: ../tempest.yml
