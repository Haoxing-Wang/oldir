---
- name: Setup openstack repos
  hosts: controller
  gather_facts: yes
  sudo: yes
  tasks:
      - name: Disable any existing repos
        shell: sed -i 's/enabled=1/enabled=0/' /etc/yum.repos.d/*
        register: shell_result
        changed_when: "shell_result.rc == 0"
        failed_when: "shell_result.rc > 2"

      - name: Install release tool on machines
        command: "yum localinstall -y {{ product.rpmrepo[ansible_distribution] }}/{{ product.name }}-release-latest.noarch.rpm"

      - name: Execute the release tool
        shell: "{{ product.name }}-release {{ product.version|int }}"
        register: shell_result
        changed_when: "shell_result == 0"

      - name: Create the COPR repos required for component tests
        template: src=templates/apevec-copr-repo.j2 dest=/etc/yum.repos.d/apevec-copr.repo
        sudo: yes
        when: ansible_distribution_version|int >= 6

      - name: Create the RHOS poodle repository
        shell: "rhos-release  -x {{ product.version|int }}{{ installer_host_repo | default('')}};  rhos-release  -d {{ product.version|int }}"
        when: product.repo_type in ['poodle']

- name: print out test env
  hosts: controller
  gather_facts: yes
  tasks:
      - name: installer.component.dir
        debug: var=installer.component.dir

      - name: HOME dir
        debug: var=ansible_env.HOME

      - name: test environment name
        debug: var=test.env_name
