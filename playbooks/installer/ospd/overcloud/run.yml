---
- name: Prepare templates and deploy the overcloud
  hosts: undercloud
  become: yes
  become_user: "{{ installer.user.name }}"
  gather_facts: yes
  tasks:
      - name: create the overcloud deploy script
        template:
            dest: "~/overcloud_deploy.sh"
            src: "templates/overcloud_deploy.sh.j2"
            mode: 0755

      - name: the create overcloud script
        shell: "cat ~/overcloud_deploy.sh"

      - name: Execute the overcloud deploy script (should take ~30 minutes :) )
        shell: "bash ~/overcloud_deploy.sh"
