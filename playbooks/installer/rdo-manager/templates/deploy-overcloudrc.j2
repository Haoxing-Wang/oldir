#!/bin/bash

export DEPLOY_COMMAND="openstack overcloud deploy --debug --log-file overcloud_deployment_{{ 100 | random }}.log --plan overcloud --neutron-network-type {{ installer.network.variant }} --neutron-tunnel-types {{ installer.network.variant }} --ntp-server {{ distro.config.ntp_server_ip }} --control-scale $CONTROLSCALE --compute-scale $COMPUTESCALE --ceph-storage-scale $CEPHSTORAGESCALE "

{% if installer.env.type != "virthost" %}
export NEUTRON_PUBLIC_INTERFACE={{ hw_env.neutron_public_interface }}
export OVERCLOUD_LIBVIRT_TYPE={{ hw_env.libvirt_type }}
export DEPLOY_COMMAND="$DEPLOY_COMMAND --libvirt-type=$OVERCLOUD_LIBVIRT_TYPE --neutron-public-interface=$NEUTRON_PUBLIC_INTERFACE --floating-ip-cidr {{ hw_env.floating_ip_cidr }} --floating-ip-start {{ hw_env.floating_ip_start }} --floating-ip-end {{ hw_env.floating_ip_end  }} --network-cidr {{ hw_env.network_cidr  }} --bm-network-gateway {{ hw_env.network_gateway }} "
{% endif %}

{% if  installer.network.network_config_name is defined and installer.env.type != "virthost" %}
export DEPLOY_COMMAND="$DEPLOY_COMMAND -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml -e ~/network-environment.yaml "
{% endif %}

{% if  installer.network.network_config_name is defined and installer.env.type == "virthost" %}
export DEPLOY_COMMAND="$DEPLOY_COMMAND --network-cidr 192.168.0.0/24 --floating-ip-cidr=172.16.23.0/24 --floating-ip-start=172.16.23.100 --floating-ip-end=172.16.23.150 --bm-network-gateway=172.16.23.251 -e /usr/share/openstack-tripleo-heat-templates/environments/network-isolation.yaml -e /usr/share/openstack-tripleo-heat-templates/environments/net-single-nic-with-vlans.yaml -e ~/network-environment.yaml "
{% endif %}
