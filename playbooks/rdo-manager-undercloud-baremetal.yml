---
- name: Create instack user {{ instack.user.stack.name }}
  hosts: undercloud
  vars:
    - ansible_ssh_user: root
  roles:
    - tripleo/instack_user

- name: copy json file
  hosts: localhost
  vars:
    - ansible_ssh_user: root
  roles:
    - rdo-manager/baremetal/copy-json-file

- name: set up json file for baremetal nodes
  hosts: undercloud
  roles:
    - rdo-manager/baremetal/setup-nodes-file

- name: Get build details
  hosts: undercloud
  sudo: yes
  roles:
    - build_mark/build

- include: rdo-manager-prep-undercloud.yml

- name: installing python-six - workaround
  hosts: undercloud
  sudo: yes
  tasks:
    yum: name=python-six state=present

- name: install instack undercloud
  hosts: undercloud
  roles:
    - rdo-manager/setup-host
    - rdo-manager/baremetal/copy-answers-file
    - rdo-manager/install-undercloud

- name: set up for overcloud deploy
  hosts: undercloud
  roles:
    - rdo-manager/baremetal/setup-for-deployment
