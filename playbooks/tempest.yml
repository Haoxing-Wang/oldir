---
- name: Gather facts from all hosts for tempest
  hosts: all:!localhost:!tempest
  tags:
    - tempest_setup
    - tempest_run

- name: Create keystonerc and install packages for tempest
  hosts: tempest
  roles:
    - { role: openstack/create-keystonerc }
  tags:
    - tempest_setup

- name: Setup tempest
  hosts: tempest
  roles:
    - { role: tempest/package-dependencies }
    - { role: tempest/setup-openstack-elements }
  tags:
    - tempest_setup

- name: Run tempest
  hosts: tempest
  roles:
    - { role: tempest, controller_fqdn: "{{ controller_name }}", tags: ["tempest_run"] }
