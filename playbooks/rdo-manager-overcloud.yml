---
- name: verify ssh connection
  hosts: all:!localhost
  roles:
    - tripleo/define-env/verify-ssh

- name: build the openstack-images
  hosts: undercloud
  roles:
   - { role: rdo-manager/build-images,
        when: installer.overcloud_images | default('build') == "build" }

- name: import the openstack-images
  hosts: undercloud
  roles:
   - { role: rdo-manager/import-images,
        when: installer.overcloud_images is defined and installer.overcloud_images == "import" }

- name: deploy the nodes
  hosts: undercloud
  roles:
   - rdo-manager/deploy-nodes

- name: deploy the nodes
  hosts: undercloud
  roles:
   - rdo-manager/instack-deploy-overcloud

#- include: rdo-manager-scale-overcloud.yml

#test-overcloud is not working at the moment
# - name: test overcloud with built in script
#   hosts: undercloud
#   roles:
#     - role: rdo-manager/test-overcloud

#- include: rdo-manager-tempest.yml
